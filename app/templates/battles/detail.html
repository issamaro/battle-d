{% extends "base.html" %}

{% block title %}Battle Detail - Battle-D{% endblock %}

{% block header_title %}Battle Detail{% endblock %}

{% block content %}
<section>
    <p><a href="/overview">‚Üê Back to Overview</a></p>
</section>

<article class="battle-card">
    <header class="battle-header">
        <h2>Battle - {{ battle.phase.value|title }}</h2>
        <span class="battle-status battle-status--{{ battle.status.value }}">
            {{ battle.status.value|upper }} {% if battle.status.value == 'completed' %}‚úÖ{% elif battle.status.value == 'active' %}üî¥{% else %}‚è∏Ô∏è{% endif %}
        </span>
    </header>

    <section class="battle-section">
        <h3>Battle Information</h3>
        <dl>
            <dt><strong>Phase:</strong></dt>
            <dd>{{ battle.phase.value|title }}</dd>

            <dt><strong>Outcome Type:</strong></dt>
            <dd>{{ battle.outcome_type.value|replace('_', ' ')|title }}</dd>

            <dt><strong>Created:</strong></dt>
            <dd>{{ battle.created_at.strftime('%Y-%m-%d %H:%M') }}</dd>

            <dt><strong>Performers:</strong></dt>
            <dd>{{ battle.performers|length }}</dd>
        </dl>
    </section>

    <section class="battle-section">
        <h3>Performers</h3>
        <div class="performer-grid">
            {% for performer in battle.performers %}
            <article class="performer-card {% if battle.winner_id and performer.id == battle.winner_id %}performer-card--winner{% endif %}">
                <p><strong>üé≠ Performer {{ loop.index }}</strong></p>
                {% if battle.winner_id and performer.id == battle.winner_id %}
                <p class="winner-badge">üèÜ Winner</p>
                {% endif %}

                {% if battle.phase.value == 'preselection' and performer.preselection_score %}
                <p class="performer-stats">Score: {{ performer.preselection_score }}</p>
                {% elif battle.phase.value == 'pools' %}
                <p class="performer-stats">W-D-L: {{ performer.pool_wins or 0 }}-{{ performer.pool_draws or 0 }}-{{ performer.pool_losses or 0 }}</p>
                <p class="performer-stats">Points: {{ performer.pool_points }}</p>
                {% endif %}
            </article>
            {% endfor %}
        </div>
    </section>

    {% if battle.outcome %}
    <section class="battle-section">
        <h3>Battle Outcome</h3>
        <details>
            <summary>View Raw Outcome Data</summary>
            <pre class="battle-outcome-data">{{ battle.outcome }}</pre>
        </details>
    </section>
    {% endif %}

    <section class="battle-section">
        <h3>Actions</h3>
        <div class="battle-actions">
            {% if battle.status.value == 'pending' %}
            <form action="/battles/{{ battle.id }}/start" method="post">
                <button type="submit" class="btn btn-primary">Start Battle</button>
            </form>
            {% elif battle.status.value == 'active' %}
            <a href="/battles/{{ battle.id }}/encode" role="button" class="btn btn-primary">Encode Result</a>
            {% else %}
            <p class="text-muted">Battle is completed. No actions available.</p>
            {% endif %}
        </div>
    </section>
</article>
{% endblock %}
