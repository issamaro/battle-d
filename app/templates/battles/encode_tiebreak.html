{% extends "base.html" %}

{% block title %}Encode Tiebreak Battle - Battle-D{% endblock %}

{% block header_title %}Encode Tiebreak Battle{% endblock %}

{% block content %}
<section>
    <p><a href="/battles/{{ battle.id }}">‚Üê Cancel</a></p>
</section>

<article style="border: 1px solid var(--pico-muted-border-color); border-radius: 8px; padding: 24px;">
    <header>
        <h2>Encode Tiebreak Result</h2>
        <p>Select the winner of this tiebreak battle.</p>
        {% if battle.outcome and battle.outcome.get('winners_needed') %}
        <p><strong>Note:</strong> {{ battle.outcome.get('winners_needed') }} winner(s) needed from {{ battle.outcome.get('total_performers') }} performers.</p>
        {% endif %}
    </header>

    <form action="/battles/{{ battle.id }}/encode" method="post" style="margin-top: 24px;">
        <section>
            <h3>Select Winner</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
                {% for performer in battle.performers %}
                <label style="border: 1px solid var(--pico-muted-border-color); border-radius: 4px; padding: 16px; cursor: pointer;">
                    <input type="radio" name="winner_id" value="{{ performer.id }}" required>
                    <div style="margin-top: 8px;">
                        <strong>üé≠ Performer {{ loop.index }}</strong>
                        {% if performer.preselection_score %}
                        <p style="margin-top: 8px; font-size: 14px;">
                            <small>Preselection Score: {{ performer.preselection_score }}</small>
                        </p>
                        {% elif performer.pool_points is not none %}
                        <p style="margin-top: 8px; font-size: 14px;">
                            <small>
                                Pool Points: {{ performer.pool_points }}<br>
                                W-D-L: {{ performer.pool_wins or 0 }}-{{ performer.pool_draws or 0 }}-{{ performer.pool_losses or 0 }}
                            </small>
                        </p>
                        {% endif %}
                    </div>
                </label>
                {% endfor %}
            </div>
        </section>

        <footer style="margin-top: 24px; display: flex; gap: 12px;">
            <button type="submit">Submit Tiebreak Result</button>
            <a href="/battles/{{ battle.id }}" role="button" class="secondary">Cancel</a>
        </footer>
    </form>
</article>
{% endblock %}
