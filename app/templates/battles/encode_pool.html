{% extends "base.html" %}

{% block title %}Encode Pool Battle - Battle-D{% endblock %}

{% block header_title %}Encode Pool Battle{% endblock %}

{% block content %}
<section>
    <p><a href="/battles/{{ battle.id }}">‚Üê Cancel</a></p>
</section>

<article class="battle-card">
    <header>
        <h2>Encode Battle Result</h2>
        <p>Select the winner of this battle, or mark it as a draw.</p>
    </header>

    <form action="/battles/{{ battle.id }}/encode" method="post" class="mt-6">
        <section>
            <h3>Select Winner</h3>
            <div class="performer-grid mb-6">
                {% for performer in battle.performers %}
                <label class="performer-option">
                    <input type="radio" name="winner_id" value="{{ performer.id }}" required>
                    <div class="performer-option-content">
                        <strong>üé≠ Performer {{ loop.index }}</strong>
                        {% if battle.phase.value == 'pools' %}
                        <p class="performer-stats">
                            W-D-L: {{ performer.pool_wins or 0 }}-{{ performer.pool_draws or 0 }}-{{ performer.pool_losses or 0 }}<br>
                            Points: {{ performer.pool_points }}
                        </p>
                        {% endif %}
                    </div>
                </label>
                {% endfor %}
            </div>

            <div class="draw-separator">
                <label class="form-check">
                    <input type="radio" name="winner_id" value="" id="draw_option" class="form-check-input">
                    <input type="hidden" name="is_draw" id="is_draw_hidden" value="false">
                    <strong>Draw</strong> - No winner
                </label>
            </div>
        </section>

        <footer class="encode-footer">
            <button type="submit" class="btn btn-primary">Submit Result</button>
            <a href="/battles/{{ battle.id }}" role="button" class="btn btn-secondary">Cancel</a>
        </footer>
    </form>
</article>

<script>
    // Handle draw option
    document.getElementById('draw_option').addEventListener('change', function() {
        if (this.checked) {
            document.getElementById('is_draw_hidden').value = 'true';
            // Clear winner_id radio buttons
            document.querySelectorAll('input[name="winner_id"]:not(#draw_option)').forEach(function(radio) {
                radio.checked = false;
            });
        }
    });

    // Handle winner selection
    document.querySelectorAll('input[name="winner_id"]:not(#draw_option)').forEach(function(radio) {
        radio.addEventListener('change', function() {
            if (this.checked) {
                document.getElementById('is_draw_hidden').value = 'false';
                document.getElementById('draw_option').checked = false;
            }
        });
    });
</script>
{% endblock %}
