{% extends "base.html" %}

{% block title %}Encode Pool Battle - Battle-D{% endblock %}

{% block header_title %}Encode Pool Battle{% endblock %}

{% block content %}
<section>
    <p><a href="/battles/{{ battle.id }}">‚Üê Cancel</a></p>
</section>

<article style="border: 1px solid var(--pico-muted-border-color); border-radius: 8px; padding: 24px;">
    <header>
        <h2>Encode Battle Result</h2>
        <p>Select the winner of this battle, or mark it as a draw.</p>
    </header>

    <form action="/battles/{{ battle.id }}/encode" method="post" style="margin-top: 24px;">
        <section>
            <h3>Select Winner</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 24px;">
                {% for performer in battle.performers %}
                <label style="border: 1px solid var(--pico-muted-border-color); border-radius: 4px; padding: 16px; cursor: pointer;">
                    <input type="radio" name="winner_id" value="{{ performer.id }}" required>
                    <div style="margin-top: 8px;">
                        <strong>üé≠ Performer {{ loop.index }}</strong>
                        {% if battle.phase.value == 'pools' %}
                        <p style="margin-top: 8px; font-size: 14px;">
                            <small>
                                W-D-L: {{ performer.pool_wins or 0 }}-{{ performer.pool_draws or 0 }}-{{ performer.pool_losses or 0 }}<br>
                                Points: {{ performer.pool_points }}
                            </small>
                        </p>
                        {% endif %}
                    </div>
                </label>
                {% endfor %}
            </div>

            <div style="border-top: 1px solid var(--pico-muted-border-color); padding-top: 16px;">
                <label>
                    <input type="radio" name="winner_id" value="" id="draw_option">
                    <input type="hidden" name="is_draw" id="is_draw_hidden" value="false">
                    <strong>Draw</strong> - No winner
                </label>
            </div>
        </section>

        <footer style="margin-top: 24px; display: flex; gap: 12px;">
            <button type="submit">Submit Result</button>
            <a href="/battles/{{ battle.id }}" role="button" class="secondary">Cancel</a>
        </footer>
    </form>
</article>

<script>
    // Handle draw option
    document.getElementById('draw_option').addEventListener('change', function() {
        if (this.checked) {
            document.getElementById('is_draw_hidden').value = 'true';
            // Clear winner_id radio buttons
            document.querySelectorAll('input[name="winner_id"]:not(#draw_option)').forEach(function(radio) {
                radio.checked = false;
            });
        }
    });

    // Handle winner selection
    document.querySelectorAll('input[name="winner_id"]:not(#draw_option)').forEach(function(radio) {
        radio.addEventListener('change', function() {
            if (this.checked) {
                document.getElementById('is_draw_hidden').value = 'false';
                document.getElementById('draw_option').checked = false;
            }
        });
    });
</script>
{% endblock %}
