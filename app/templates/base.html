<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Battle-D{% endblock %}</title>

    <!-- Battle-D Design System (compiled from SCSS) -->
    <link rel="stylesheet" href="/static/css/main.css">

    <!-- HTMX for interactive UI without full page reloads -->
    <script src="https://unpkg.com/htmx.org@2.0.4" integrity="sha384-HGfztofotfshcF7+8n44JQL2oJmowVChPTg48S+jvZoztPfvwD79OC/LTtG6dMp+" crossorigin="anonymous"></script>

    <!-- Error Handling JavaScript -->
    <script src="/static/js/error-handling.js" defer></script>
</head>
<body class="{% if current_user %}app-layout{% else %}simple-layout{% endif %}">
    {% if current_user %}
    <!-- Vertical Sidebar Navigation -->
    <aside class="sidebar">
        <div class="sidebar-logo">
            <span class="logo-text">Battle-D</span>
        </div>
        <nav class="sidebar-nav">
            <ul class="nav-list">
                {% if current_user.is_staff %}
                <li>
                    <a href="/tournaments" class="nav-item {% if '/tournaments' in request.url.path %}is-active{% endif %}">
                        Tournaments
                    </a>
                </li>
                <li>
                    <a href="/dancers" class="nav-item {% if '/dancers' in request.url.path %}is-active{% endif %}">
                        Dancers
                    </a>
                </li>
                {% endif %}

                {% if current_user.is_admin %}
                <li>
                    <a href="/admin/users" class="nav-item {% if '/admin' in request.url.path %}is-active{% endif %}">
                        Users
                    </a>
                </li>
                {% endif %}

                {% if active_tournament and (current_user.is_mc or current_user.is_admin) %}
                <li><hr class="nav-divider"></li>
                <li>
                    <a href="/event/{{ active_tournament.id }}" class="nav-item nav-item-event-mode {% if '/event' in request.url.path %}is-active{% endif %}">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>
                        </svg>
                        Event Mode
                    </a>
                </li>
                {% endif %}
            </ul>
        </nav>
        <div class="sidebar-footer">
            <div class="sidebar-user">
                <div>
                    <div class="user-name">{{ current_user.email }}</div>
                    <div class="user-role">{{ current_user.role }}</div>
                </div>
            </div>
            <a href="/auth/logout" class="nav-item">Logout</a>
        </div>
    </aside>

    <!-- Header -->
    <header class="header">
        <h1 class="header-title">{% block header_title %}Battle-D{% endblock %}</h1>
        <div class="profile-header">
            <span class="profile-name">{{ current_user.email }}</span>
            <span class="profile-role">{{ current_user.role }}</span>
        </div>
    </header>
    {% endif %}

    <!-- Flash Messages -->
    {% include "components/flash_messages.html" %}

    <!-- Main Content -->
    <main class="main">
        <div class="{% if current_user %}container-fluid{% else %}container{% endif %}">
            {% block content %}{% endblock %}
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <p>Battle-D Tournament Management System</p>
    </footer>
</body>
</html>
