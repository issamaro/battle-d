{% extends "base.html" %}

{% block title %}Tournament Management - Battle-D{% endblock %}

{% block header_title %}Tournament Management{% endblock %}

{% block content %}
<div class="page-header">
    <div>
        <h2 class="page-title">All Tournaments</h2>
        <p class="page-subtitle">Manage your breakdancing tournaments</p>
    </div>
    <button
        type="button"
        class="btn btn-create"
        onclick="document.getElementById('create-tournament-modal').showModal()"
    >
        + Create Tournament
    </button>
</div>

{% if has_integrity_issue and current_user.is_admin %}
<div class="card mb-4">
    <div class="card-header card-header-warning">
        <div class="card-header-content">
            <h3 class="card-title">Data Integrity Warning</h3>
        </div>
    </div>
    <div class="card-body">
        <p>
            <strong>Multiple active tournaments detected.</strong>
            Only one tournament should be active at a time.
            <a href="/overview">Visit Overview to fix this issue</a>.
        </p>
    </div>
</div>
{% endif %}

{% if tournaments %}
<div id="tournament-list" class="card-grid">
    {% for tournament in tournaments %}
    <article class="card tournament-card">
        <div class="card-body">
            <div class="tournament-card-header">
                <h3 class="tournament-card-title">{{ tournament.name }}</h3>
                <button type="button" class="btn-icon" aria-label="More options">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="1"/>
                        <circle cx="12" cy="5" r="1"/>
                        <circle cx="12" cy="19" r="1"/>
                    </svg>
                </button>
            </div>

            <div class="tournament-card-meta">
                <div class="card-meta">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <rect width="18" height="18" x="3" y="4" rx="2" ry="2"/>
                        <line x1="16" x2="16" y1="2" y2="6"/>
                        <line x1="8" x2="8" y1="2" y2="6"/>
                        <line x1="3" x2="21" y1="10" y2="10"/>
                    </svg>
                    <span>{{ tournament.created_at.strftime('%d/%m/%Y') }}</span>
                </div>
            </div>

            <div class="tournament-card-footer">
                {% set phase_class = {
                    'registration': 'badge-registration',
                    'preselection': 'badge-preselection',
                    'pools': 'badge-pools',
                    'finals': 'badge-finals',
                    'completed': 'badge-completed'
                }.get(tournament.phase.value, 'badge-pending') %}
                <span class="badge {{ phase_class }}">
                    {{ tournament.phase.value|capitalize }}
                </span>
                <a href="/tournaments/{{ tournament.id }}" class="btn btn-sm btn-secondary">View</a>
            </div>
        </div>
    </article>
    {% endfor %}
</div>

<p class="text-muted mt-4">
    <strong>Total:</strong> {{ tournaments|length }} tournament{% if tournaments|length != 1 %}s{% endif %}
</p>
{% else %}
<div id="tournament-list">
    {% set title = "No Tournaments Yet" %}
    {% set message = "Create your first tournament to get started" %}
    {% set icon = "trophy" %}
    {% include "components/empty_state.html" %}
</div>
{% endif %}

{# Tournament Create Modal #}
{% include "components/tournament_create_modal.html" %}
{% endblock %}
