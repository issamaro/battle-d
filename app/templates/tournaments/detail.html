{% extends "base.html" %}

{% block title %}{{ tournament.name }} - Battle-D{% endblock %}

{% block content %}
<h2>Tournament: {{ tournament.name }}</h2>

<section>
    <p><a href="/tournaments">&larr; Back to Tournaments</a></p>
</section>

<!-- Tournament Info Card - Use PicoCSS article -->
<article>
    <header>
        <h3>Tournament Information</h3>
    </header>

    <table>
        <tr>
            <td><strong>Status:</strong></td>
            <td>
                <span class="badge {% if tournament.status.value == 'active' %}badge-active{% elif tournament.status.value == 'cancelled' %}badge-warning{% else %}badge-pending{% endif %}">
                    {{ tournament.status.value|upper }}
                </span>
            </td>
        </tr>
        <tr>
            <td><strong>Phase:</strong></td>
            <td>
                <span class="badge badge-active">
                    {{ tournament.phase.value|upper }}
                </span>
            </td>
        </tr>
        <tr>
            <td><strong>Created:</strong></td>
            <td>{{ tournament.created_at.strftime('%Y-%m-%d %H:%M') }}</td>
        </tr>
    </table>

    {% if current_user.is_mc or current_user.is_admin %}
    <footer>
        <a href="/event/{{ tournament.id }}" role="button" class="secondary">
            Event Mode
        </a>
    </footer>
    {% endif %}
</article>

<!-- Categories Section -->
<section>
    <h3>Categories</h3>

    <p>
        <a href="/tournaments/{{ tournament.id }}/add-category" role="button">
            + Add Category
        </a>
    </p>

    {% if category_data %}
        <figure>
            <table role="grid">
                <thead>
                    <tr>
                        <th>Category Name</th>
                        <th>Type</th>
                        <th>Registered</th>
                        <th>Minimum Required</th>
                        <th>Ideal Capacity</th>
                        <th>Pools</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in category_data %}
                    {% set minimum_required = item.category.minimum_performers_required %}
                    {% set is_ready = item.performer_count >= minimum_required %}
                    <tr>
                        <td><strong>{{ item.category.name }}</strong></td>
                        <td>{{ item.category.category_type }}</td>
                        <td>
                            <span class="badge {% if is_ready %}badge-completed{% else %}badge-pending{% endif %}">
                                {{ item.performer_count }}
                            </span>
                        </td>
                        <td>{{ minimum_required }}</td>
                        <td>
                            {{ item.category.ideal_pool_capacity }}
                            <br>
                            <small>({{ item.category.performers_ideal }}/pool)</small>
                        </td>
                        <td>{{ item.category.groups_ideal }}</td>
                        <td>
                            <a href="/registration/{{ tournament.id }}/{{ item.category.id }}">Register Dancers</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </figure>

        <small>
            <strong>Legend:</strong>
            <span class="badge badge-completed">Green</span> = Ready to advance |
            <span class="badge badge-pending">Gray</span> = Need more performers
        </small>
    {% else %}
        {% set title = "No Categories Yet" %}
        {% set message = "Add a category to get started with registration!" %}
        {% set action_url = "/tournaments/" ~ tournament.id ~ "/add-category" %}
        {% set action_text = "Add Category" %}
        {% set icon = "folder" %}
        {% include "components/empty_state.html" %}
    {% endif %}
</section>
{% endblock %}
