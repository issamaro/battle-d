{% extends "base.html" %}

{% block title %}Add Category - Battle-D{% endblock %}

{% block content %}
<h2>Add Category to {{ tournament.name }}</h2>

<section>
    <p><a href="/tournaments/{{ tournament.id }}">‚Üê Back to Tournament</a></p>
</section>

<section>
    <form method="post" action="/tournaments/{{ tournament.id }}/add-category" style="max-width: 700px;">
        <div style="margin-bottom: 15px;">
            <label for="name">Category Name:</label><br>
            <input type="text" id="name" name="name" required placeholder="e.g., Hip Hop Boys 1v1" style="width: 100%; padding: 8px;">
            <small style="color: #6c757d;">Be specific: include style, gender/age group, and battle type</small>
        </div>

        <div style="margin-bottom: 20px;">
            <label>
                <input type="checkbox" name="is_duo" value="true" id="is-duo-checkbox">
                2v2 Category (Duo battles)
            </label>
            <br>
            <small style="color: #6c757d;">Check this if dancers compete in pairs</small>
        </div>

        <div style="margin-bottom: 15px;">
            <label for="groups_ideal">Number of Pools (Groups):</label><br>
            <input type="number"
                   id="groups_ideal"
                   name="groups_ideal"
                   value="2"
                   min="1"
                   max="10"
                   required
                   style="width: 100%; padding: 8px;"
                   oninput="updateMinimumCalculation()">
            <small style="color: #6c757d;">Number of pool groups for round-robin battles (Fixed at registration)</small>
        </div>

        <div style="margin-bottom: 15px;">
            <label for="performers_ideal">Target Performers Per Pool:</label><br>
            <input type="number"
                   id="performers_ideal"
                   name="performers_ideal"
                   value="4"
                   min="2"
                   max="20"
                   required
                   style="width: 100%; padding: 8px;"
                   oninput="updateMinimumCalculation()">
            <small style="color: #6c757d;">Ideal size for each pool (Adaptive based on registrations)</small>
        </div>

        <div style="margin-bottom: 20px; padding: 15px; background-color: #fff3cd; border-left: 4px solid #ffc107;">
            <h4 style="margin-top: 0;">üìä Category Requirements</h4>

            <p style="margin: 5px 0;">
                <strong>Minimum Required Performers:</strong>
                <span id="min-display" style="font-size: 20px; color: #856404;">5</span>
            </p>

            <p style="margin: 5px 0; font-size: 14px; color: #856404;">
                <strong>Formula:</strong> <span id="formula-display">(2 pools √ó 2 minimum) + 1 elimination</span>
            </p>

            <hr style="border-top: 1px solid #856404; margin: 10px 0;">

            <p style="margin: 5px 0; font-size: 14px;">
                <strong>Ideal Pool Capacity:</strong> <span id="ideal-display">8</span> performers
                <br>
                <small>(After preselection: <span id="pools-display">2</span> pools √ó <span id="per-pool-display">4</span> performers/pool)</small>
            </p>
        </div>

        <div style="margin-bottom: 15px; padding: 10px; background-color: #d1ecf1; border-left: 3px solid #0c5460;">
            <p style="margin: 0; font-size: 14px; color: #0c5460;">
                <strong>How it works:</strong><br>
                ‚Ä¢ Registration phase: Collect performers (need at least the minimum)<br>
                ‚Ä¢ Preselection phase: Eliminate performers to reach pool capacity<br>
                ‚Ä¢ Pools phase: Round-robin battles within each pool<br>
                ‚Ä¢ Finals phase: Pool winners compete for championship
            </p>
        </div>

        <button type="submit" style="background-color: #28a745; color: white; padding: 10px 20px; border: none; cursor: pointer; border-radius: 4px;">
            Add Category
        </button>
        <a href="/tournaments/{{ tournament.id }}" style="margin-left: 10px;">Cancel</a>
    </form>
</section>

<script>
function updateMinimumCalculation() {
    const groupsIdeal = parseInt(document.getElementById('groups_ideal').value) || 2;
    const performersIdeal = parseInt(document.getElementById('performers_ideal').value) || 4;

    // Formula: (groups_ideal * 2) + 1
    const minimum = (groupsIdeal * 2) + 1;

    // Ideal pool capacity: groups_ideal * performers_ideal
    const idealCapacity = groupsIdeal * performersIdeal;

    // Update displays
    document.getElementById('min-display').textContent = minimum;
    document.getElementById('formula-display').textContent =
        `(${groupsIdeal} pools √ó 2 minimum) + 1 elimination`;
    document.getElementById('ideal-display').textContent = idealCapacity;
    document.getElementById('pools-display').textContent = groupsIdeal;
    document.getElementById('per-pool-display').textContent = performersIdeal;
}

// Initialize on page load
document.addEventListener('DOMContentLoaded', updateMinimumCalculation);
</script>
{% endblock %}
