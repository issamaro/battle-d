{% extends "base.html" %}

{% block title %}Add Category - Battle-D{% endblock %}

{% block content %}
<h2>Add Category to {{ tournament.name }}</h2>

<section>
    <p><a href="/tournaments/{{ tournament.id }}">‚Üê Back to Tournament</a></p>
</section>

<section>
    <form method="post" action="/tournaments/{{ tournament.id }}/add-category" class="form">
        <div class="form-group">
            <label for="name" class="form-label">Category Name:</label>
            <input type="text" id="name" name="name" required placeholder="e.g., Hip Hop Boys 1v1" class="form-input">
            <small class="form-help">Be specific: include style, gender/age group, and battle type</small>
        </div>

        <div class="form-group">
            <label class="form-check">
                <input type="checkbox" name="is_duo" value="true" id="is-duo-checkbox" class="form-check-input">
                <span class="form-check-label">2v2 Category (Duo battles)</span>
            </label>
            <small class="form-help">Check this if dancers compete in pairs</small>
        </div>

        <div class="form-group">
            <label for="groups_ideal" class="form-label">Number of Pools (Groups):</label>
            <input type="number"
                   id="groups_ideal"
                   name="groups_ideal"
                   value="2"
                   min="1"
                   max="10"
                   required
                   class="form-input"
                   oninput="updateMinimumCalculation()">
            <small class="form-help">Number of pool groups for round-robin battles (Fixed at registration)</small>
        </div>

        <div class="form-group">
            <label for="performers_ideal" class="form-label">Target Performers Per Pool:</label>
            <input type="number"
                   id="performers_ideal"
                   name="performers_ideal"
                   value="4"
                   min="2"
                   max="20"
                   required
                   class="form-input"
                   oninput="updateMinimumCalculation()">
            <small class="form-help">Ideal size for each pool (Adaptive based on registrations)</small>
        </div>

        <div class="calculator-box">
            <h4>üìä Category Requirements</h4>

            <p>
                <strong>Minimum Required Performers:</strong>
                <span id="min-display" class="calculator-value">5</span>
            </p>

            <p class="calculator-formula">
                <strong>Formula:</strong> <span id="formula-display">(2 pools √ó 2 minimum) + 1 elimination</span>
            </p>

            <hr>

            <p>
                <strong>Ideal Pool Capacity:</strong> <span id="ideal-display">8</span> performers
                <br>
                <small>(After preselection: <span id="pools-display">2</span> pools √ó <span id="per-pool-display">4</span> performers/pool)</small>
            </p>
        </div>

        <div class="howto-box">
            <p>
                <strong>How it works:</strong><br>
                ‚Ä¢ Registration phase: Collect performers (need at least the minimum)<br>
                ‚Ä¢ Preselection phase: Eliminate performers to reach pool capacity<br>
                ‚Ä¢ Pools phase: Round-robin battles within each pool<br>
                ‚Ä¢ Finals phase: Pool winners compete for championship
            </p>
        </div>

        <div class="form-actions">
            <button type="submit" class="btn btn-primary">
                Add Category
            </button>
            <a href="/tournaments/{{ tournament.id }}" class="btn btn-secondary">Cancel</a>
        </div>
    </form>
</section>

<script>
function updateMinimumCalculation() {
    const groupsIdeal = parseInt(document.getElementById('groups_ideal').value) || 2;
    const performersIdeal = parseInt(document.getElementById('performers_ideal').value) || 4;

    // Formula: (groups_ideal * 2) + 1
    const minimum = (groupsIdeal * 2) + 1;

    // Ideal pool capacity: groups_ideal * performers_ideal
    const idealCapacity = groupsIdeal * performersIdeal;

    // Update displays
    document.getElementById('min-display').textContent = minimum;
    document.getElementById('formula-display').textContent =
        `(${groupsIdeal} pools √ó 2 minimum) + 1 elimination`;
    document.getElementById('ideal-display').textContent = idealCapacity;
    document.getElementById('pools-display').textContent = groupsIdeal;
    document.getElementById('per-pool-display').textContent = performersIdeal;
}

// Initialize on page load
document.addEventListener('DOMContentLoaded', updateMinimumCalculation);
</script>
{% endblock %}
